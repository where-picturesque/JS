<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/bootstrap/css/bootstrap.css' />
    <style>
      .container{
        width:600px;
      }
      input[type="file"]{
        float: left;
      }
      #preview{
        float: left;
      }
      #preview img{
        width: 50px;
      }

    </style>
  </head>
  <body>
    <%-include("./header.ejs",{title:"添加商品",addgood:true,isshow:true,showlogin:false,showreg:false,showlogout:true,showuser:true})%>
	
    <div class="container">
      <%if(isNew){%>
      <form class="form-horizontal" method="post" action="/addgoods" enctype="multipart/form-data">
        <div class="form-group">
          <label for="inputEmail3" class="col-sm-2 control-label">商品名称</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="inputEmail3" placeholder="商品名称" name="title">
          </div>
        </div>
        <div class="form-group">
          <label for="inputEmail3" class="col-sm-2 control-label">描述</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="inputEmail3" placeholder="描述" name="description">
          </div>
        </div>
        <div class="form-group">
          <label for="inputPassword3" class="col-sm-2 control-label">价格</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="inputPassword3" placeholder="价格" name="price">
          </div>
        </div>
        <div class="form-group">
          <label for="inputEmail3" class="col-sm-2 control-label">数量</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="inputEmail3" placeholder="数量" name="num">
          </div>
        </div>
        <div class="form-group">
          <label for="inputPassword3" class="col-sm-2 control-label">分类</label>
          <div class="col-sm-10">
            
            <div class="btn-group">
                <input type="text" class="btn btn-default" id="categoryInp" placeholder="类别"  name="type" />
                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <span class="caret"></span>
                  
                </button>
                <ul class="dropdown-menu " id="category">
                  <%for(var i=0;i<category.length;i++){%>
                    <li><a href="#"><%=category[i]%></a></li>
                  <%}%>
                  
                </ul>
              </div>
          </div>
        </div>
        <div class="form-group">
          <label for="inputPassword3" class="col-sm-2 control-label">适用性别</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="inputPassword3" placeholder="性别" name="sex">
          </div>
        </div>
        <div class="form-group">
          <label for="inputPassword3" class="col-sm-2 control-label">尺码</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="inputPassword3" placeholder="请以逗号分隔" name="size">
          </div>
        </div>
        <div class="form-group">
          <label for="exampleInputFile" class="col-sm-2 control-label"> 商品图片</label>
          <input type="file" id="upload" name="photo" multiple="multiple">
          <div id="preview">
            <img src="/images/others/2.jpg" class="previewimg">
          </div>
        </div>
       
        <div class="form-group">
          <div class="col-sm-offset-2 col-sm-10">
            <input type="hidden" value="<%=curshop._id%>" name="shopid">
            <button type="submit" class="btn btn-default">添加</button>
          </div>
        </div>
      </form>
      <%}else{%>
        <form class="form-horizontal" method="post" action="/addgoods/update" enctype="multipart/form-data">
        <div class="form-group">
          <label for="inputEmail3" class="col-sm-2 control-label">商品名称</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="inputEmail3" placeholder="商品名称" name="title" value="<%=goodresult.title%>">
          </div>
        </div>
        <div class="form-group">
          <label for="inputEmail3" class="col-sm-2 control-label">描述</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="inputEmail3" placeholder="描述" name="description" value="<%=goodresult.description%>">
          </div>
        </div>
        <div class="form-group">
          <label for="inputPassword3" class="col-sm-2 control-label">价格</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="inputPassword3" placeholder="价格" name="price" value="<%=goodresult.price%>">
          </div>
        </div>
        <div class="form-group">
          <label for="inputEmail3" class="col-sm-2 control-label">数量</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="inputEmail3" placeholder="数量" name="num" value="<%=goodresult.num%>">
          </div>
        </div>
        <div class="form-group">
          <label for="inputPassword3" class="col-sm-2 control-label">分类</label>
          <div class="col-sm-10">      
            <div class="btn-group">
                <input type="text" class="btn btn-default" id="categoryInp" placeholder="类别"  name="type" value="<%=goodresult.type%>" />
                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <span class="caret"></span>
                  
                </button>
                <ul class="dropdown-menu " id="category">
                  <%for(var i=0;i<category.length;i++){%>
                    <li><a href="#"><%=category[i]%></a></li>
                  <%}%>
                  
                </ul>
              </div>
          
          </div>
        </div>
        <div class="form-group">
          <label for="inputPassword3" class="col-sm-2 control-label">适用性别</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="inputPassword3" placeholder="性别" name="sex"  value="<%=goodresult.sex%>">
          </div>
        </div>
        <div class="form-group">
          <label for="inputPassword3" class="col-sm-2 control-label">尺码</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="inputPassword3" placeholder="请以逗号分隔" name="size"  value="<%=goodresult.size%>">
          </div>
        </div>
        <div class="form-group">
          <label for="exampleInputFile" class="col-sm-2 control-label"> 商品图片</label>
          <input type="file"  id="upload"  name="photo" multiple="multiple">
          <div id="preview">
            <img src="/images/others/2.jpg" class="previewimg">
          </div>
        </div>
       
        <div class="form-group">
          <div class="col-sm-offset-2 col-sm-10">
            <input type="hidden" name="goodid" value="<%=goodresult._id%>">
            <button type="submit" class="btn btn-default">更新</button>
          </div>
        </div>
      </form>
      <%}%>
    </div>
	

    <script src="/bootstrap/js/jquery-1.11.0.js"></script>
    <script src="/bootstrap/js/bootstrap.js"></script>
    <script>
      var category=document.getElementById("category");
      var categorybtns=category.getElementsByTagName("li");
      var categoryInp=document.getElementById("categoryInp");

      //选择类别 输入框会显示相应的类别名
      category.addEventListener("click",function (e) {
        console.log(e.target.innerHTML);
        categoryInp.value=e.target.innerHTML;
      })


      $("#upload").on("change",function () {
        // console.log(this.files.length);//文件长度
        $(".previewimgs").remove();
        if(this.files.length==0){
          $(".previewimg").show().attr ("src","/images/others/2.jpg");
          
        }else{
          $(".previewimg").hide();
           for(var i = 0; i<this.files.length ;i++){
            var fr = new FileReader(); // 
            var files = this.files[i]; // files可以获取当前文件输入框中选择的所有文件，返回列表
            fr.readAsDataURL(files); // 读取的内容是加密以后的本地文件路径
            fr.onload = function(e){ // 数据读取完成时触发onload对应的响应函数
                // e.target是FileReader等同于fr
                var $previewimg =$("<img />");
                $previewimg.addClass("previewimgs").attr ("src", e.target.result);;
                $("#preview").append($previewimg);
               
            }       
        }

        }
      })

    </script>
  </body>
</html>
